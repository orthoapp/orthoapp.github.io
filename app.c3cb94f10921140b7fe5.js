webpackJsonp([0],[,function(t,e){t.exports='<md-content flex="100" class="content-full-size" ui-view></md-content>'},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e,o){this.id=t,this.date=e,this.patient=o,this.points=[],this.fileUrl=null,this.imageWidth=null,this.imageHeight=null,this.uploadedFile=null}return t.prototype.getDateAsString=function(){return this.date.toString()},t.prototype.getPointsJson=function(){for(var t=[],e=0,o=this.points;e<o.length;e++){var i=o[e];i.id&&i.x&&i.y&&t.push({id:i.id,x:i.x,y:i.y})}return t},t}();e.Trg=o}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e,o(22),o(23),o(24),o(26),o(27),o(39),o(43),o(47),o(33),o(34),o(46),o(25),o(49),o(41),o(35)],void 0!==(n=function(t,e,i,n,r,s,a,c,l,d,p,u,g,h,m,f,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o(12),angular.module("cabinet",["ngMessages","ui.router","ngMaterial"]).constant("globalDateFormat","DD.MM.YYYY").constant("googleClientId",v.environment.googleClientId).constant("googleApiKey",v.environment.googleApiKey).constant("yandexClientId",v.environment.yandexClientId).constant("dropboxClientId",v.environment.dropboxClientId).config(n.LocaleConfig).config(r.Oauth2Config).config(s.StatesConfig).config(a.ThemeConfig).config(h.SceConfig).directive("chooseFile",p.ChooseFileDirective).directive("viewBox",u.ViewBoxDirective).service("$authUser",c.AuthUser).provider("GoogleApi",l.GoogleApiProvider).provider("YandexApi",m.YandexApiProvider).provider("DropboxApi",f.DropboxApiProvider).service("TrgService",d.TrgService).service("TrgHandbookService",g.TrgHandbookService).run(i.AppBootstrapFactory)}.apply(e,i))&&(t.exports=n)},,,,,,,,,function(t,e){},function(t,e,o){t.exports=o.p+"719d40cf74e1791b7d8c23b9d3e711ee.svg"},function(t,e,o){t.exports=o.p+"9282531b63a8fa118377792f49b2bfca.svg"},,function(t,e){t.exports='<div class="content-centered" layout="row" layout-align="center center" ui-view></div>'},function(t,e){t.exports='<md-content flex="100" layout="row" class="trg-canvas" ng-init="$root.pageTitle = \'Пациент \' + model.patient + \'. Снимок ТРГ от \' + model.date"><div class="trg-canvas-tools md-toolbar-item" ng-if="!currentPoint"><md-fab-speed-dial md-direction="down" class="md-scale trg-canvas-tools-menu"><md-fab-trigger><md-button class="md-accent md-fab md-icon-button md-mini" aria-label="Добавить точку" title="Добавить точку"><md-tooltip md-direction="right">Добавить точку</md-tooltip><md-icon md-svg-src="navigation:add"></md-icon></md-button></md-fab-trigger><md-fab-actions><div ng-repeat="point in points" class="trg-canvas-tools-vertical-item"><md-button class="md-mini md-fab md-icon-button" aria-label="{{point.description}}" ng-click="setCurrentPoint(point)" ng-class="{\'md-raised\' : point.x === null && point.y === null, \'md-warn\' : point.x !== null && point.y !== null}"><md-icon md-font-icon aria-label="{{point.description}}">{{point.id}}</md-icon><md-tooltip md-direction="right">{{point.description}}</md-tooltip></md-button></div></md-fab-actions></md-fab-speed-dial><md-fab-speed-dial md-direction="down" class="md-scale trg-canvas-tools-menu" md-open="viewSegmentsButtons" ng-click="viewSegmentsButtons = !viewSegmentsButtons"><md-fab-trigger><md-button class="md-accent md-fab md-icon-button md-mini" aria-label="Показать отрезки и плоскости" title="Показать отрезки и плоскости"><md-tooltip md-direction="right">Показать отрезки и плоскости</md-tooltip><md-icon md-svg-src="navigation:linear"></md-icon></md-button></md-fab-trigger><md-fab-actions><div ng-repeat="segment in segments" class="trg-canvas-tools-vertical-item"><md-button class="md-mini md-fab md-raised md-icon-button" aria-label="{{segment.description}}" ng-class="{\'md-raised\' : !segment.visible, \'md-warn\' : segment.visible}" ng-click="toggleSegment($event, segment); viewSegmentsButtons = true;"><md-tooltip md-direction="right">{{segment.description}}</md-tooltip><md-icon md-font-icon aria-label="{{segment.description}}">{{segment.id}}</md-icon></md-button></div></md-fab-actions></md-fab-speed-dial><md-button class="md-mini md-fab md-icon-button" ng-click="textVisible = !textVisible" aria-label="Скрыть / Показать подписи" title="Скрыть / Показать подписи" ng-class="{\'md-warn\' : !textVisible, \'md-accent\' : textVisible}"><md-tooltip md-direction="up">Скрыть / Показать подписи</md-tooltip><md-icon aria-label="Скрыть / Показать подписи" md-svg-src="navigation:spellchecker"></md-icon></md-button><md-button class="md-warn md-mini md-fab md-icon-button" ng-click="canvasZoom(0.1)" title="Увеличить" aria-label="Увеличить"><md-tooltip md-direction="up">Увеличить</md-tooltip><md-icon md-svg-src="navigation:zoom-in" aria-label="Увеличить"></md-icon></md-button><md-button class="md-warn md-mini md-fab md-icon-button" ng-click="canvasZoom(-0.1)" title="Уменьшить" aria-label="Уменьшить"><md-tooltip md-direction="up">Уменьшить</md-tooltip><md-icon md-svg-src="navigation:zoom-out" aria-label="Уменьшить"></md-icon></md-button><md-button ng-if="!needToSave" class="md-primary md-hue-2 md-mini md-fab md-icon-button" ng-click="TrgService.openReport(model)" title="Просмотреть отчет" aria-label="Просмотреть отчет"><md-tooltip md-autohide="false" md-visible="true" md-direction="right">Просмотреть отчет</md-tooltip><md-icon md-svg-src="navigation:report" aria-label="Просмотреть отчет"></md-icon></md-button><md-button ng-if="needToSave" class="md-primary md-hue-2 md-mini md-fab md-icon-button" ng-click="saveChanges()" title="Сохранить изменения" aria-label="Сохранить изменения"><md-tooltip md-autohide="false" md-visible="true" md-direction="right">Сохранить изменения</md-tooltip><md-icon md-svg-src="navigation:save" aria-label="Сохранить изменения"></md-icon></md-button></div><div class="trg-canvas-map full-size-scroll-container" ng-if="model.fileUrl"><svg ng-click="canvasClick($event)" ng-mousemove="canvasMouseMove($event)" data-view-box="{{\'0 0 \' + model.imageWidth + \' \' + model.imageHeight}}" ng-attr-width="{{canvasWidth}}" ng-attr-height="{{canvasHeight}}"><image ng-attr-height="{{model.imageHeight}}" ng-attr-width="{{model.imageWidth}}" xlink:href="{{model.fileUrl}}"/><g ng-repeat="segment in segments"><title>{{segment.description}}</title><path ng-show="segment.path !== null && segment.visible" ng-attr-d="{{segment.path}}" ng-attr-stroke="{{segment.color}}" ng-attr-stroke-width="{{segment.width}}"/></g><g ng-repeat="point in points"><title>{{point.description}}</title><text ng-show="textVisible" ng-attr-x="{{point.x + point.radius * 2}}" ng-attr-y="{{point.y - point.radius * 2}}" ng-attr-font-size="{{point.fontSize}}" ng-attr-fill="{{point.color}}" font-family="Verdana" stroke="none">{{point.id}}</text><circle ng-attr-fill="{{point.color}}" ng-attr-stroke="{{point.color}}" fill-opacity="0.5" stroke-opacity="0.8" ng-mousedown="setCurrentPoint(point)" ng-mouseup="setCurrentPoint(null)" ng-attr-r="{{point.radius}}" ng-attr-cx="{{point.x}}" ng-attr-cy="{{point.y}}" ng-show="point.x !== null && point.y !== null"/></g></svg></div></md-content>'},function(t,e){t.exports='<div class="trg-modal-form"><md-toolbar><div class="md-toolbar-tools"><h2>{{trg.id ? \'Редактирование ТРГ\' : \'Загрузка ТРГ\'}}</h2><span flex class="flex"></span><md-button class="md-icon-button md-button" ng-click="cancel()" aria-label="Закрыть"><md-icon md-svg-src="navigation:close"></md-icon></md-button></div></md-toolbar><form novalidate name="trgForm" method="post" flex ng-submit="submit()"><md-dialog-content><div class="md-dialog-content" layout="row" layout-wrap><p class="md-padding">Введите дату снимка, имя пациента и выберите изображение ТРГ со своего компьютера. После этого вы сможете расставить антропологические точки на снимке и система автоматически выдаст вам отчет с указанием значений антропологических параметров.</p><md-input-container flex-gt-sm="50" flex="100"><label for="trg_date" class="required">Дата снимка</label><md-datepicker id="trg_date" name="trg[date]" required="required" ng-model="trg.date"></md-datepicker><div ng-messages="trgForm[\'trg[date]\'].$error"><div ng-message="required">Поле обязательно для заполнения</div><div ng-message="remote">{{remoteFormMessages[\'trgForm\'][\'trg[date]\']}}</div></div></md-input-container><md-input-container flex-gt-sm="50" flex="100"><label for="trg_patient" class="required">Пациент</label><input type="text" id="trg_patient" name="trg[patient]" required="required" ng-model="trg.patient"><div ng-messages="trgForm[\'trg[patient]\'].$error"><div ng-message="required">Поле обязательно для заполнения</div><div ng-message="remote">{{remoteFormMessages[\'trgForm\'][\'trg[patient]\']}}</div></div></md-input-container><md-input-container ng-if="!trg.id" flex class="md-icon-float"><choose-file layout="row" target-model="trg.uploadedFile"><md-button class="md-mini md-fab" aria-label="Выбрать файл"><md-icon md-svg-src="navigation:attach"></md-icon></md-button><div class="md-input" flex>{{trg.uploadedFile.name || \'Файл не выбран\'}}</div><div style="display:none"><input aria-label="Файл снимка ТРГ" type="file" style="opacity: 0" id="trg_uploadedFile" name="trg[uploadedFile]" required="required" ng-model="trg.uploadedFile"></div></choose-file><div ng-messages="trgForm[\'trg[uploadedFile]\'].$error"><div ng-message="required">Поле обязательно для заполнения</div><div ng-message="remote">{{remoteFormMessages[\'trgForm\'][\'trg[uploadedFile]\']}}</div></div></md-input-container></div></md-dialog-content><md-dialog-actions><md-button type="submit" class="md-raised md-primary">{{trg.id ? \'Обновить\' : \'Загрузить\'}}</md-button><span flex class="flex"></span> <a href="#" ng-click="cancel()" class="md-button">Отмена</a></md-dialog-actions></form></div>'},function(t,e){t.exports='<div class="trg-list" ng-if="TrgService.items.length > 0"><md-button class="md-accent md-mini md-fab md-icon-button trg-list-add" ng-click="TrgService.openForm(null)" aria-label="Загрузить новый снимок" title="Загрузить новый снимок"><md-icon md-svg-src="navigation:add" alt="Загрузить новый снимок"></md-icon></md-button><md-content flex="100" layout="row" class="trg-list-table"><table class="md-table"><thead class="md-table-header"><th flex></th><th flex="20">Дата снимка</th><th flex="40">Пациент</th><th flex="20">Проводились иследования</th><th flex="10"></th></thead><tbody class="md-table-body"><tr ng-repeat="item in TrgService.items"><td></td><td>{{item.getDateAsString()}}</td><td>{{item.patient}}</td><td>{{item.points.length > 0 ? \'Да\' : \'Нет\'}}</td><td><md-menu><md-button class="md-icon-button" aria-label="Действия с снимком" ng-click="openMenu($mdMenu, $event)"><md-icon md-svg-src="navigation:submenu-vert-inverse"></md-icon></md-button><md-menu-content width="4"><md-menu-item><md-button aria-label="Открыть редактор снимка" ng-click="TrgService.openCanvas(item)"><md-icon md-svg-src="navigation:visibility-inverse"></md-icon>Открыть</md-button></md-menu-item><md-menu-item ng-if="item.points.length > 0"><md-button aria-label="Отчет по снимку" ng-click="TrgService.openReport(item)"><md-icon md-svg-src="navigation:report-inverse"></md-icon>Отчет</md-button></md-menu-item><md-menu-item><md-button aria-label="Редактировать снимок" ng-click="TrgService.openForm(item)"><md-icon md-svg-src="navigation:edit-inverse"></md-icon>Редактировать</md-button></md-menu-item><md-menu-divider></md-menu-divider><md-menu-item><md-button aria-label="Удалить снимок" ng-click="TrgService.removeItem(item)"><md-icon md-svg-src="navigation:delete-inverse"></md-icon>Удалить</md-button></md-menu-item></md-menu-content></md-menu></td></tr></tbody></table></md-content></div><div class="trg-empty-list" ng-if="TrgService.items.length == 0"><md-content class="md-text-block md-padding"><p><span class="md-headline md-padding">У вас еще нет снимков ТРГ</span><br><a href="#" ng-click="TrgService.openForm(null); $event.preventDefault();">Добавить первый снимок</a></p></md-content><md-content class="md-text-block md-padding"><md-icon md-svg-icon="info:cloud-computing" class="md-big-icon"></md-icon></md-content><md-content class="md-text-block md-padding"><p>На этой странице будут появляться данные о добавленных и обработанных вами снимках ТРГ. А пока здесь ничего нет, можем приступить к <a href="#" ng-click="TrgService.openForm(null); $event.preventDefault();">добавлению первого снимка</a>.</p></md-content></div>'},function(t,e){t.exports='<div class="trg-modal-report"><md-toolbar><div class="md-toolbar-tools"><h2>Отчет ТРГ. Пациент {{model.patient}}, дата {{model.getDateAsString()}}</h2><span flex class="flex"></span><md-button aria-label="Закрыть" class="md-icon-button md-button" ng-click="cancel()"><md-icon md-svg-src="navigation:close"></md-icon></md-button></div></md-toolbar><md-subheader class="md-accent" ng-if="notSetPoints.length > 0" layout="row"><md-icon md-svg-src="navigation:warning-inverse"></md-icon>&nbsp;&nbsp; <strong>Для полного отчета необходимо установить точки:&nbsp;</strong> <span ng-repeat="point in notSetPoints">{{point.id}}{{$last ? \'\' : \', \'}}</span></md-subheader><md-content flex="100" layout="row" class="trg-modal-report-table"><table class="md-table"><thead class="md-table-header"><th flex="20">Угол</th><th flex="60">Описание</th><th flex="20">Значение</th></thead><tbody class="md-table-body"><tr ng-repeat="corner in corners"><td>{{corner.id}}</td><td>{{corner.description}}</td><td>{{corner.degree != null ? corner.degree : \' - \'}}</td></tr></tbody></table></md-content></div>'},function(t,e){t.exports='<md-content><h1>Авторизация</h1><p>Для работы в orthoapp.ru требуется авторизация.</p><p>Мы не храним данные на нашем сервере, вместо этого мы предлагаем вам авторизоваться через облачное хранилище, в котором будут сохраняться ваши снимки ТРГ и доступны только вам.</p><p>Мы не передаем ваши аккаунты, e-mail, снимки и другую информацию от ваших социальных сервисов третьим лицам.</p><p>Приложению orthoapp.ru будет использовать только личную папку приложения.</p><p><strong>Выберите сервис, в котором будут сохраняться снимки ТРГ:</strong></p><md-button type="button" class="social-link" ng-click="login(\'google\')"><md-icon md-svg-src="info:google-drive"></md-icon><span>Google Drive</span></md-button><md-button type="button" class="social-link" ng-click="login(\'yandex\')"><md-icon md-svg-src="info:yandex-disk"></md-icon><span>Яндекс.Диск</span></md-button><md-button type="button" class="social-link" ng-click="login(\'dropbox\')"><md-icon md-svg-src="info:dropbox"></md-icon><span>Dropbox</span></md-button></md-content>'},function(t,e,o){(function(i){var n,r;n=[o,e],void 0!==(r=function(t,e){"use strict";function o(t,e,o,i,r,s){var a=new n(t,e,o,i,r,s);return a.pageTitleProvider(),a.bindAuth(),a.attachServices(),a.bindStates(),a}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,o,n,r,s){var a=this;this.$rootScope=t,this.$state=e,this.$authUser=o,this.$mdDialog=n,this.TrgService=r,this.pageTitleProvider=function(){a.$rootScope.pageTitle=null,a.$rootScope.$watch("pageTitle",function(){a.$rootScope.pageTitle?a.$rootScope.title=a.$rootScope.pageTitle+" — Orthoapp.ru":a.$rootScope.title="Orthoapp.ru"})},this.bindAuth=function(){a.$rootScope.auth=!1,a.$rootScope.authService=null,a.$rootScope.user=null,a.$rootScope.$on("signIn",function(t,e,o,i){a.$rootScope.auth=!0,a.$rootScope.authService=e,a.$rootScope.user=i,a.$authUser.goLastState()}),a.$rootScope.$on("signReject",function(){a.$state.go("login")}),a.$rootScope.logout=function(){a.$rootScope.auth=!1,a.$rootScope.user=null,a.$rootScope.authService=null,a.$authUser.logout(),a.$state.go("login")}},this.attachServices=function(){a.$rootScope.$state=a.$state,a.$rootScope.TrgService=a.TrgService},this.bindStates=function(){a.$rootScope.$on("$stateChangeStart",function(t,e){a.$rootScope.pageTitle=null,a.$rootScope.pageLoader=!0,e.data&&e.data.allowAnonymous||a.$rootScope.auth||(a.$authUser.saveCurrentState(),a.$state.go("login"))}),a.$rootScope.$on("$stateChangeSuccess",function(t,e){e.data&&e.data.pageTitle&&(a.$rootScope.pageTitle=e.data.pageTitle),a.$rootScope.pageLoader=!1}),a.$rootScope.$on("$stateChangeError",function(t,e,o,i,n,r){a.$rootScope.pageLoader=!1,r=r||{status:500},void 0!=r.doNotCatch&&1==r.doNotCatch||(r.status&&404==r.status?a.$mdDialog.show(a.$mdDialog.alert().parent(document.getElementsByName("body")[0]).title("404").textContent("Page not found").ok("Ok")):r.status&&401==r.status?a.$rootScope.$state.go("login"):a.$mdDialog.show(a.$mdDialog.alert().parent(document.getElementsByName("body")[0]).title(r.status).textContent("System error").ok("Ok")))})},t.openMenu=function(t,e){t.open(e)},Date.prototype.toString=function(){var t=i(this);return t.isValid()?t.format(s):""},t.pageLoader=!1}return t}();e.AppBoostrap=n,e.AppBootstrapFactory=o,o.$inject=["$rootScope","$state","$authUser","$mdDialog","TrgService","globalDateFormat"]}.apply(e,n))&&(t.exports=r)}).call(e,o(0))},function(t,e,o){(function(i){var n,r;n=[o,e],void 0!==(r=function(t,e){"use strict";function o(t,e){t.months=["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],t.shortMonths=["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"],t.days=["понедельник","вторник","среда","четверг","пятница","суббота","воскресенье"],t.shortDays=["пн","вт","ср","чт","пт","сб","вс"],t.firstDayOfWeek=1,t.formatDate=function(t){var o=i(t);return o.isValid()?o.format(e):i().format(e)},t.parseDate=function(t){var o=i(t,e);return o.isValid()?o.toDate():new Date(NaN)}}Object.defineProperty(e,"__esModule",{value:!0}),e.LocaleConfig=o,o.$inject=["$mdDateLocaleProvider","globalDateFormat"]}.apply(e,n))&&(t.exports=r)}).call(e,o(0))},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";function o(t,e,o,i,n,r,s){t.init({clientId:e,apiKey:o}),i.setClientId(n),r.setClientId(s)}Object.defineProperty(e,"__esModule",{value:!0}),e.Oauth2Config=o,o.$inject=["GoogleApiProvider","googleClientId","googleApiKey","YandexApiProvider","yandexClientId","DropboxApiProvider","dropboxClientId"]}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";function o(t){t.resourceUrlWhitelist(["self","https://drive.google.com/**","https://www.drive.google.com/**","https://**.yandex.net/**","https://**.yandex.ru/**","https://**.dropboxusercontent.com/**"])}Object.defineProperty(e,"__esModule",{value:!0}),e.SceConfig=o,o.$inject=["$sceDelegateProvider"]}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e,o(28),o(29),o(31)],void 0!==(n=function(t,e,i,n,r){"use strict";function s(t,e){t.state("centered",{abstract:!0,views:{"@":{template:o(16)}}}).state("full-size",{abstract:!0,views:{"@":{template:o(1)}}}).state("login",{parent:"centered",url:"/login",template:o(21),controller:i.LoginController,data:{pageTitle:"Авторизация",allowAnonymous:!0}}).state("research",{url:"/research",template:"<ui-view />",abstract:!0}).state("research.trg",{url:"/trg",template:o(1)}).state("research.trg.list",{url:"/list",template:o(19),controller:r.TrgListController,resolve:{isAuth:["$authUser","TrgService",function(t,e){return t.getFileService().then(function(){return!0})}]},data:{pageTitle:"Мои снимки ТРГ"}}).state("research.trg.canvas",{url:"/canvas/:id",template:o(17),resolve:{trg:["TrgService","$stateParams",function(t,e){return t.getItem(e.id)}]},controller:n.TrgCanvasController}),e.when("","/research/trg/list")}Object.defineProperty(e,"__esModule",{value:!0}),e.StatesConfig=s,s.$inject=["$stateProvider","$urlRouterProvider"]}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";function i(t,e){t.theme("default").primaryPalette("teal").accentPalette("deep-orange").warnPalette("red"),e.iconSet("navigation",o(14),24).iconSet("info",o(13),24)}Object.defineProperty(e,"__esModule",{value:!0}),e.ThemeConfig=i,i.$inject=["$mdThemingProvider","$mdIconProvider"]}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";function o(t,e){t.login=function(t){e.login(t)}}Object.defineProperty(e,"__esModule",{value:!0}),e.LoginController=o,o.$inject=["$scope","$authUser"]}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";function o(t,e,o,i){t.needToSave=!1;var n=1;t.points=i.points,t.segments=o.populateSegmentsFromPoints(i.points),t.model=i,t.canvasWidth=i.imageWidth*n,t.canvasHeight=i.imageHeight*n,t.textVisible=!1,t.currentPoint=null;var r=function(){n<.1?n=.1:n>20&&(n=20);for(var e=0,o=t.points;e<o.length;e++){o[e].calculate(n)}t.canvasWidth=i.imageWidth*n,t.canvasHeight=i.imageHeight*n};r(),t.setCurrentPoint=function(e){t.currentPoint=e},t.canvasMouseMove=function(e){if(t.currentPoint){for(var o=0,i=0,r=0,s=e.path;r<s.length;r++){var a=s[r];if("svg"==a.tagName){var c=angular.element(a),l=c[0];o=l.getBoundingClientRect().left,i=l.getBoundingClientRect().top}}t.currentPoint.setPosition(e.pageX-o,e.pageY-i,n),t.needToSave=!0}},t.saveChanges=function(){e.updateItem(t.model.id,t.model).then(function(){},function(){}),t.currentPoint=null,t.needToSave=!1},t.canvasClick=function(e){t.currentPoint&&(t.currentPoint=null)},t.canvasZoom=function(t){n+=t,r()},t.toggleSegment=function(t,e){t.stopImmediatePropagation(),e.visible=!e.visible}}Object.defineProperty(e,"__esModule",{value:!0}),e.TrgCanvasController=o,o.$inject=["$scope","TrgService","TrgHandbookService","trg"]}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e,o(2)],void 0!==(n=function(t,e,o){"use strict";function i(t,e,i,n){e.trg=t||new o.Trg("",new Date,""),e.submit=function(){if(!e.trgForm.$valid)return!1;e.trg.id?n.updateItem(e.trg.id,e.trg).then(function(){i.cancel()}):n.createItem(e.trg.uploadedFile,e.trg.date,e.trg.patient).then(function(t){n.openCanvas(t),i.cancel()})},e.cancel=function(){i.cancel()}}Object.defineProperty(e,"__esModule",{value:!0}),e.TrgFormController=i,i.$inject=["item","$scope","$mdDialog","TrgService"]}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";function o(t,e,o){t.TrgService=o}Object.defineProperty(e,"__esModule",{value:!0}),e.TrgListController=o,o.$inject=["$scope","isAuth","TrgService"]}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";function o(t,e,o,i){t.model=i,t.corners=o.populateCornersFromPoints(i.points);for(var n=0,r=t.corners;n<r.length;n++){r[n].calculateDegree()}t.notSetPoints=[];for(var s=0,a=t.model.points;s<a.length;s++){var c=a[s];c.x||c.y||t.notSetPoints.push(c)}t.cancel=function(){e.cancel()}}Object.defineProperty(e,"__esModule",{value:!0}),e.TrgReportController=o,o.$inject=["$scope","$mdDialog","TrgHandbookService","trg"]}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";function o(t){return{link:function(e,o,i){var n=o.find("input"),r=i.targetModel;o.bind("click",function(){n[0].click()}),n.bind("change",function(o){e.$apply(function(){var i=o.target.files;i&&i[0]?t(r).assign(e,i[0]):t(r).assign(e,{})})})}}}Object.defineProperty(e,"__esModule",{value:!0}),e.ChooseFileDirective=o,o.$inject=["$parse"]}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";function o(){return{link:function(t,e,o){o.$observe("viewBox",function(t){e.attr("viewBox",""+t)})}}}Object.defineProperty(e,"__esModule",{value:!0}),e.ViewBoxDirective=o}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.environment={googleClientId:"238005663019-aifk27andl4lfsplq81q5q44iraircis.apps.googleusercontent.com",googleApiKey:"AIzaSyD5QfVBeNCSwkScHpy08gbqfqs7FkCqQEM",yandexClientId:"ce9b6c5c0a42421985b4d8bdd6440c85",dropboxClientId:"vnw6u68hai6no5m"}}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e,o){this.id=t,this.description=e,this.pointIds=o}return t.prototype.checkPoint11=function(t){return void 0!=this.pointIds[0]&&this.pointIds[0]==t.id},t.prototype.checkPoint12=function(t){return void 0!=this.pointIds[1]&&this.pointIds[1]==t.id},t.prototype.checkPoint21=function(t){return void 0!=this.pointIds[2]&&this.pointIds[2]==t.id},t.prototype.checkPoint22=function(t){return void 0!=this.pointIds[3]&&this.pointIds[3]==t.id},t.prototype.calculateDegree=function(){if(null==this.point11.x||null==this.point11.y||null==this.point12.x||null==this.point12.y||null==this.point21.x||null==this.point21.y||null==this.point22.x||null==this.point22.y)return null;var t=this.point12.x-this.point11.x,e=this.point12.y-this.point11.y,o=this.point22.x-this.point21.x,i=this.point22.y-this.point21.y,n=Math.sqrt(t*t+e*e)*Math.sqrt(o*o+i*i);if(0==n)return null;var r=(t*o+e*i)/n;this.degree=Math.round(57.29577951308232*Math.acos(r)*100)/100},t}();e.Corner=o}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e,o,i,n){void 0===e&&(e=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===n&&(n=null),this.id=t,this.x=e,this.y=o,this.color=i,this.description=n,this.defaultRadius=3,this.defaultFontSize=20,this.segments=[],this.radius=3,this.fontSize=20,this.calculate(1)}return t.prototype.calculate=function(t){this.fontSize=this.defaultFontSize/t,this.radius=this.defaultRadius/t;for(var e=0,o=this.segments;e<o.length;e++){o[e].calculate(t)}},t.prototype.setPosition=function(t,e,o){this.x=t/o,this.y=e/o,this.calculate(o)},t}();e.Point=o}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e,o,i,n,r,s){void 0===n&&(n=null),void 0===r&&(r=null),void 0===s&&(s=[]);var a=this;this.id=t,this.color=e,this.isPlane=o,this.description=i,this.point1=n,this.point2=r,this.pointsIds=s,this.path=null,this.defaultWidth=2,this.width=2,this.visible=!1,this.calculate=function(t){a.path=null,a.point1.x&&a.point2.x&&a.point1.y&&a.point2.y&&(a.path="M"+a.point1.x+" "+a.point1.y+" L"+a.point2.x+" "+a.point2.y),a.width=a.defaultWidth/t},this.checkPoint1=function(t){return void 0!=a.pointsIds[0]&&a.pointsIds[0]==t.id},this.checkPoint2=function(t){return void 0!=a.pointsIds[1]&&a.pointsIds[1]==t.id}}return t}();e.Segment=o}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e,o,i,n,r){this.$q=t,this.$state=e,this.$rootScope=o,this.lastState=null,this.externalServices=[],this.externalServices.push(i),this.externalServices.push(n),this.externalServices.push(r)}return t.prototype.getFileService=function(){for(var t=this.$q.defer(),e=this.externalServices.length,o=0,i=this.externalServices;o<i.length;o++){var n=i[o];!function(o){o.getIsSignedIn().then(function(i){1==i?t.resolve(o):0==--e&&t.reject({status:401})})}(n)}return t.promise},t.prototype.saveCurrentState=function(){this.lastState=location.hash},t.prototype.getSavedState=function(){var t=this.lastState;return this.lastState=null,t},t.prototype.goLastState=function(){var t=this.getSavedState();t?location.hash=t:this.$state.go("research.trg.list")},t.prototype.login=function(t){this.logout();for(var e=0,o=this.externalServices;e<o.length;e++){var i=o[e];if(i.code==t)return void i.signIn()}throw new Error("Unknown service name")},t.prototype.logout=function(){for(var t=0,e=this.externalServices;t<e.length;t++){var o=e[t];o.signOut(),this.$rootScope.$emit("signOut",o.code)}},t.$inject=["$q","$state","$rootScope","GoogleApi","YandexApi","DropboxApi"],t}();e.AuthUser=o}.apply(e,i))&&(t.exports=n)},function(t,e,o){(function(i){var n,r;n=[o,e],void 0!==(r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e,o,i,n){var r=this;this.$rootScope=t,this.$q=e,this.$location=o,this.$http=i,this.dropboxClientId=n,this.code="dropbox",this.authorizationUrl="https://www.dropbox.com/oauth2/authorize",this.apiUrl="https://api.dropboxapi.com/2/",this.contentUrl="https://content.dropboxapi.com/2/",this.fieldToken="dropboxToken",this.fieldAccountId="dropboxAccountId",this.listenAuthentication=function(){r.$rootScope.$on("$locationChangeSuccess",function(t,e){if(/state=dropbox/.test(e)){var o=/access_token=([^&]+)/,i=/error=([^&]+)/,n=/account_id=([^&]+)/;o.test(e)&&n.test(e)?(localStorage.setItem(r.fieldToken,o.exec(e)[1]),localStorage.setItem(r.fieldAccountId,n.exec(e)[1]),r.fetchProfile().then(function(t){r.$rootScope.$emit("signIn",r.code,t,t)},function(){r.signOut(),r.$rootScope.$emit("signReject",r.code)})):i.test(e)&&r.$rootScope.$emit("signReject",r.code),r.$location.url("/")}}),r.getToken()&&r.fetchProfile().then(function(t){r.$rootScope.$emit("signIn",r.code,t,t)},function(){r.signOut(),r.$rootScope.$emit("signReject",r.code)})},this.signIn=function(){location.href=r.authorizationUrl+"?response_type=token&client_id="+r.dropboxClientId+"&redirect_uri="+location.origin+"&state=dropbox"},this.signOut=function(){localStorage.removeItem(r.fieldToken),localStorage.removeItem(r.fieldAccountId),location.hash=""},this.getExtensionByMimeType=function(t){var e="";switch(t){case"image/jpeg":case"image/jpg":e="jpg";break;case"image/png":e="png";break;case"image/gif":e="gif";break;default:throw new Error("Unknown file type")}return e},this.handleFileError=function(t){return function(e){throw t.error=e.data.error_summary||e.statusText,t.errorCode=e.status,t}},this.listenAuthentication()}return t.prototype.fetchProfile=function(){return this.$http.post(this.apiUrl+"users/get_account",{account_id:this.getAccountId()},{headers:this.getRequestHeaders()}).then(function(t){return{userName:t.data.name.given_name,email:t.data.email}})},t.prototype.getRequestHeaders=function(){return{Authorization:"Bearer "+this.getToken()}},t.prototype.getAccountId=function(){return localStorage.getItem(this.fieldAccountId)},t.prototype.getToken=function(){return localStorage.getItem(this.fieldToken)},t.prototype.getIsSignedIn=function(){var t=this.$q.defer();return t.resolve(!!this.getToken()),t.promise},t.prototype.getRemotePath=function(t){return void 0===t&&(t=""),"/"+this.basename(t)},t.prototype.getPropertiesFile=function(t){return this.getRemotePath("__."+t+".json")},t.prototype.getOriginFileName=function(t){var e=/^__\.(.*)\.json$/;return t=this.basename(t),e.test(t)?t.replace(e,"$1"):null},t.prototype.basename=function(t){return t.split("/").pop()},t.prototype.uploadFile=function(t){var e=this,o=this.getExtensionByMimeType(t.uploadedFile.type),n=i(new Date).format("YYYYMMDDHHmmss")+"."+o,r=this.getRemotePath(n),s=[];for(var a in t.properties)s.push({name:a,value:t.properties[a]});return this.$http.post(this.contentUrl+"files/upload",t.uploadedFile,{headers:{Authorization:"Bearer "+this.getToken(),"Dropbox-API-Arg":JSON.stringify({path:r,mode:"add",autorename:!0,mute:!1}),"Content-Type":"application/octet-stream"}}).then(function(o){return t.id=o.data.name,e.updateFile(t)},this.handleFileError(t))},t.prototype.fetchFileProperties=function(t){var e=this,o=this.getPropertiesFile(t);return this.$http.post(this.apiUrl+"files/get_temporary_link",{path:o},{headers:this.getRequestHeaders()}).then(function(o){return e.$http.get(o.data.link).then(function(e){var o=e.data;return{id:t,properties:o}})})},t.prototype.getFiles=function(){var t=this,e=this.$q.defer(),o=[];return this.$http.post(this.apiUrl+"files/list_folder",{path:"",recursive:!1,include_media_info:!1,include_deleted:!1,include_has_explicit_shared_members:!1},{headers:this.getRequestHeaders()}).then(function(i){for(var n=0,r=function(){n<1&&e.resolve(o)},s=0,a=i.data.entries;s<a.length;s++){var c=a[s],l=t.getOriginFileName(c.name);l&&(n++,t.fetchFileProperties(l).then(function(t){n--,o.push(t),r()},function(){n--,r()}))}r()},function(){e.reject(o)}),e.promise},t.prototype.getFile=function(t){var e=null,o=null,i={id:t},n=this.$q.defer(),r=function(){if(e&&o){i.url=o,i.properties=e;var t=new Image;t.src=i.url,t.onload=function(){i.imageWidth=t.width,i.imageHeight=t.height,n.resolve(i)}}};return this.$http.post(this.apiUrl+"files/get_temporary_link",{path:this.getRemotePath(t)},{headers:this.getRequestHeaders()}).then(function(t){o=t.data.link,r()},this.handleFileError(i)),this.fetchFileProperties(t).then(function(t){e=t.properties,r()},this.handleFileError(i)),n.promise},t.prototype.removeFile=function(t){var e=this.$q.defer(),o=0,i=function(){2==o&&e.resolve(!0)};return this.$http.post(this.apiUrl+"files/delete",{path:this.getRemotePath(t)},{headers:this.getRequestHeaders()}).then(function(){o++,i()},function(){e.reject(!1)}),this.$http.post(this.apiUrl+"files/delete",{path:this.getPropertiesFile(t)},{headers:this.getRequestHeaders()}).then(function(){o++,i()},function(){e.reject(!1)}),e.promise},t.prototype.updateFile=function(t){return this.$http.post(this.contentUrl+"files/upload",JSON.stringify(t.properties),{headers:{Authorization:"Bearer "+this.getToken(),"Dropbox-API-Arg":JSON.stringify({path:this.getPropertiesFile(t.id),mode:"overwrite",autorename:!0,mute:!1}),"Content-Type":"application/octet-stream"}}).then(function(){return t},this.handleFileError(t))},t}();e.DropboxApi=o}.apply(e,n))&&(t.exports=r)}).call(e,o(0))},function(t,e,o){var i,n;i=[o,e,o(40)],void 0!==(n=function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){var t=this;this.$get=["$rootScope","$q","$location","$http",function(e,i,n,r){return t.instance||(t.instance=new o.DropboxApi(e,i,n,r,t.clientId)),t.instance}]}return t.prototype.setClientId=function(t){this.clientId=t},t}();e.DropboxApiProvider=i}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e,o(44)],void 0!==(n=function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,i){var n=this;this.$rootScope=t,this.$q=e,this.googleApiOptions=i,this.code="google",this.updateSignInStatus=function(t){t&&n.gapiDefer.promise.then(function(){if(n.GoogleUser=n.GoogleAuth.currentUser.get(),n.GoogleUser.hasGrantedScopes(n.googleApiOptions.scope)){var t={userName:n.GoogleUser.getBasicProfile().getGivenName(),email:n.GoogleUser.getBasicProfile().getEmail()};n.$rootScope.$emit("signIn",n.code,n.GoogleUser,t)}else n.$rootScope.$emit("signReject",n.code)})},this.init=function(){gapi.client.init(n.googleApiOptions).then(function(){n.GoogleAuth=gapi.auth2.getAuthInstance(),n.gapiDefer.resolve(!0),n.GoogleAuth.isSignedIn.listen(n.updateSignInStatus),n.updateSignInStatus(n.GoogleAuth.isSignedIn.get())},function(){n.gapiDefer.reject(!1)})},this.signIn=function(){n.gapiDefer.promise.then(function(){n.GoogleAuth.isSignedIn.get()||n.GoogleAuth.signIn()})},this.signOut=function(){n.gapiDefer.promise.then(function(){n.GoogleAuth.signOut()})},this.uploadFile=function(t){var e=n.$q.defer();return n.gapiDefer.promise.then(function(){var i={title:t.uploadedFile.name,description:"Снимок ТРГ в приложении orthoapp.ru",mimeType:t.uploadedFile.type||"application/octet-stream",properties:t.properties};new o.GoogleDriveMediaUploader({file:t.uploadedFile,token:n.GoogleUser.getAuthResponse().access_token,metadata:i,onError:function(o){var i=JSON.parse(o);t.errorCode=i.error.code,t.error=i.error.message,e.reject(t)},onComplete:function(o){var i=JSON.parse(o);t.id=i.id,e.resolve(t)}}).upload()}),e.promise},this.getFiles=function(){var t=n.$q.defer();return n.gapiDefer.promise.then(function(){gapi.client.drive.files.list({pageSize:1e3,fields:"files(id, properties, webContentLink, imageMediaMetadata)"}).then(function(e){for(var o=[],i=0,n=e.result.files;i<n.length;i++){var r=n[i],s={id:r.id,properties:r.properties};o.push(s)}t.resolve(o)},function(){t.reject([])})}),t.promise},this.getFile=function(t){var e=n.$q.defer();return n.gapiDefer.promise.then(function(){gapi.client.drive.files.get({fileId:t,fields:"id, properties, webContentLink, imageMediaMetadata"}).then(function(t){var o={id:t.result.id,properties:t.result.properties,url:t.result.webContentLink,imageWidth:t.result.imageMediaMetadata.width,imageHeight:t.result.imageMediaMetadata.height},i=new Image;i.src=o.url,i.onload=function(){e.resolve(o)}},function(t){var o={error:t.result.error.message,errorCode:t.result.error.code};e.reject(o)})}),e.promise},this.removeFile=function(t){var e=n.$q.defer();return n.gapiDefer.promise.then(function(){gapi.client.drive.files.delete({fileId:t}).then(function(){e.resolve(!0)},function(){e.reject(!1)})}),e.promise},this.updateFile=function(t){var e=n.$q.defer();return n.gapiDefer.promise.then(function(){gapi.client.drive.files.update({fileId:t.id,properties:t.properties}).then(function(){e.resolve(t)},function(o){t.error=o.result.error.message,t.errorCode=o.result.error.code,e.reject(t)})}),e.promise},this.gapiDefer=this.$q.defer(),gapi.load("client:auth2",this.init)}return t.prototype.getIsSignedIn=function(){var t=this;return this.gapiDefer.promise.then(function(){return t.GoogleAuth.isSignedIn.get()})},t}();e.GoogleApi=i}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e,o(42)],void 0!==(n=function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){var t=this;this.options={clientId:null,apiKey:null,scope:"https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/drive.file",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]},this.$get=["$rootScope","$q",function(e,i){return t.instance||(t.instance=new o.GoogleApi(e,i,t.options)),t.instance}]}return t.prototype.init=function(t){this.options=angular.merge(this.options,t)},t}();e.GoogleApiProvider=i}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e,o(45)],void 0!==(n=function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){var e=function(){};if(this.file=t.file,this.contentType=t.contentType||this.file.type||"application/octet-stream",this.metadata=t.metadata||{title:t.file.name,mimeType:this.contentType},this.token=t.token,this.onComplete=t.onComplete||e,this.onProgress=t.onProgress||e,this.onError=t.onError||e,this.offset=t.offset||0,this.chunkSize=t.chunkSize||0,this.retryHandler=new o.RetryHandler,this.url=t.url,!this.url){var i=t.params||{};i.uploadType="resumable",this.url=this.buildUrl_(t.fileId,i,t.baseUrl)}this.httpMethod=t.fileId?"PUT":"POST"}return t.prototype.upload=function(){var t=this,e=new XMLHttpRequest;e.open(this.httpMethod,this.url,!0),e.setRequestHeader("Authorization","Bearer "+this.token),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("X-Upload-Content-Length",this.file.size.toString()),e.setRequestHeader("X-Upload-Content-Type",this.contentType),e.onload=function(e){if(e.target.status<400){var o=e.target.getResponseHeader("Location");t.url=o,t.sendFile_()}else t.onUploadError_(e)},e.onload.bind(this),e.onerror=this.onUploadError_.bind(this),e.send(JSON.stringify(this.metadata))},t.prototype.sendFile_=function(){var t=this.file,e=this.file.size;(this.offset||this.chunkSize)&&(this.chunkSize&&(e=Math.min(this.offset+this.chunkSize,this.file.size)),t=t.slice(this.offset,e));var o=new XMLHttpRequest;o.open("PUT",this.url,!0),o.setRequestHeader("Content-Type",this.contentType),o.setRequestHeader("Content-Range","bytes "+this.offset+"-"+(e-1)+"/"+this.file.size),o.setRequestHeader("X-Upload-Content-Type",this.file.type),o.upload&&o.upload.addEventListener("progress",this.onProgress),o.onload=this.onContentUploadSuccess_.bind(this),o.onerror=this.onContentUploadError_.bind(this),o.send(t)},t.prototype.resume_=function(){var t=new XMLHttpRequest;t.open("PUT",this.url,!0),t.setRequestHeader("Content-Range","bytes */"+this.file.size),t.setRequestHeader("X-Upload-Content-Type",this.file.type),t.upload&&t.upload.addEventListener("progress",this.onProgress),t.onload=this.onContentUploadSuccess_.bind(this),t.onerror=this.onContentUploadError_.bind(this),t.send()},t.prototype.extractRange_=function(t){var e=t.getResponseHeader("Range");e&&(this.offset=parseInt(e.match(/\d+/g).pop(),10)+1)},t.prototype.onContentUploadSuccess_=function(t){200==t.target.status||201==t.target.status?this.onComplete(t.target.response):308==t.target.status?(this.extractRange_(t.target),this.retryHandler.reset(),this.sendFile_()):this.onContentUploadError_(t)},t.prototype.onContentUploadError_=function(t){t.target.status&&t.target.status<500?this.onError(t.target.response):this.retryHandler.retry(this.resume_.bind(this))},t.prototype.onUploadError_=function(t){this.onError(t.target.response)},t.prototype.buildQuery_=function(t){return void 0===t&&(t=null),t=t||{},Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},t.prototype.buildUrl_=function(t,e,o){void 0===t&&(t=null),void 0===o&&(o=null);var i=o||"https://www.googleapis.com/upload/drive/v3/files/";t&&(i+=t);var n=this.buildQuery_(e);return n&&(i+="?"+n),i},t}();e.GoogleDriveMediaUploader=i}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e],void 0!==(n=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){void 0===t&&(t=1e3),void 0===e&&(e=6e4),this.interval=t,this.maxInterval=e}return t.prototype.retry=function(t){setTimeout(t,this.interval),this.interval=this.nextInterval_()},t.prototype.reset=function(){this.interval=1e3},t.prototype.nextInterval_=function(){var t=2*this.interval+this.getRandomInt_(0,1e3);return Math.min(t,this.maxInterval)},t.prototype.getRandomInt_=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},t}();e.RetryHandler=o}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e,o(37),o(38),o(36)],void 0!==(n=function(t,e,i,n,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){var t=this;this.populatePointsFromArray=function(e){for(var o={},i=0,n=e;i<n.length;i++){var r=n[i];void 0!=r.id&&void 0!=r.x&&void 0!=r.y&&(o[r.id]=r)}for(var s=t.getHandbookPoints(),a=0,c=s;a<c.length;a++){var l=c[a];void 0!=o[l.id]&&(l.x=o[l.id].x,l.y=o[l.id].y)}return s},this.populateSegmentsFromPoints=function(e){for(var o=t.getHandbookSegments(),i=0,n=o;i<n.length;i++)for(var r=n[i],s=0,a=e;s<a.length;s++){var c=a[s];r.checkPoint1(c)?(r.point1=c,c.segments.push(r)):r.checkPoint2(c)&&(r.point2=c,c.segments.push(r))}return o},this.populateCornersFromPoints=function(e){for(var o=t.getHandbookCorners(),i=0,n=e;i<n.length;i++)for(var r=n[i],s=0,a=o;s<a.length;s++){var c=a[s];c.checkPoint11(r)&&(c.point11=r),c.checkPoint12(r)&&(c.point12=r),c.checkPoint21(r)&&(c.point21=r),c.checkPoint22(r)&&(c.point22=r)}return o}}return t.prototype.getHandbookPoints=function(){for(var t=[],e=o(52),n=0,r=e;n<r.length;n++){var s=r[n];t.push(new i.Point(s.id,null,null,s.color,s.description))}return t},t.prototype.getHandbookSegments=function(){for(var t=[],e=o(53),i=0,r=e;i<r.length;i++){var s=r[i];t.push(new n.Segment(s.id,s.color,s.plane,s.description,null,null,[s.points[0],s.points[1]]))}return t},t.prototype.getHandbookCorners=function(){for(var t=[],e=o(51),i=0,n=e;i<n.length;i++){var s=n[i];t.push(new r.Corner(s.id,s.description,s.points))}return t},t}();e.TrgHandbookService=s}.apply(e,i))&&(t.exports=n)},function(t,e,o){var i,n;i=[o,e,o(2),o(30),o(32)],void 0!==(n=function(t,e,i,n,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e,o,i,n,r){var s=this;this.TrgHandbookService=t,this.$rootScope=e,this.$mdDialog=o,this.$mdDateLocale=i,this.$state=n,this.$authUser=r,this.items=[],this.handleError=function(t,e){if(void 0===e&&(e=""),!e)switch(t){case 401:e="Требуется авторизация";break;case 400:e="Ошибочный запрос";break;case 404:e="Страница не найдена"}throw s.$mdDialog.show(s.$mdDialog.alert().parent(document.getElementsByName("body")[0]).title(t+"").textContent(e)),{errorCode:t,error:e,doNotCatch:!0}},this.handleFileError=function(t){s.handleError(t.errorCode,t.error),t.errorCode=null,t.error=null},this.$rootScope.$on("signIn",function(){s.items=[],s.fillAllItems()}),this.$rootScope.$on("signReject",function(){s.items=[]}),this.$rootScope.$on("signOut",function(){s.items=[]})}return t.prototype.getPointsJsonFromFileProperties=function(t){var e=[];for(var o in t)if(/^point/.test(o))try{var i=JSON.parse(t[o]);e.push(i)}catch(t){}return e},t.prototype.fillAllItems=function(){var t=this;this.$authUser.getFileService().then(function(e){e.getFiles().then(function(e){for(var o=0,n=e;o<n.length;o++){var r=n[o],s=new i.Trg(r.id,t.$mdDateLocale.parseDate(r.properties.date),r.properties.patient),a=t.getPointsJsonFromFileProperties(r.properties);s.points=t.TrgHandbookService.populatePointsFromArray(a),t.items.push(s)}},function(){t.items=[]})},function(){t.handleError(401)})},t.prototype.getItem=function(t){var e=this;return this.$authUser.getFileService().then(function(o){return o.getFile(t).then(function(t){var o=new i.Trg(t.id,e.$mdDateLocale.parseDate(t.properties.date),t.properties.patient),n=e.getPointsJsonFromFileProperties(t.properties);return o.points=e.TrgHandbookService.populatePointsFromArray(n),o.fileUrl=t.url,o.imageWidth=t.imageWidth,o.imageHeight=t.imageHeight,o},e.handleFileError)},function(){e.handleError(401)})},t.prototype.openReport=function(t){this.$mdDialog.show({controller:r.TrgReportController,template:o(20),locals:{trg:t},clickOutsideToClose:!0,parent:angular.element(document.body)})},t.prototype.openCanvas=function(t){this.$state.go("research.trg.canvas",{id:t.id})},t.prototype.openForm=function(t){void 0===t&&(t=null),this.$mdDialog.show({controller:n.TrgFormController,template:o(18),locals:{item:t},clickOutsideToClose:!0,parent:angular.element(document.body)})},t.prototype.removeItem=function(t){var e=this,o=function(){for(var o in e.items)e.items[o].id==t.id&&e.items.splice(+o,1)};this.$authUser.getFileService().then(function(i){e.$rootScope.pageLoader=!0,i.removeFile(t.id).then(o,function(){e.handleError(400,"Не удалось удалить файл")}).finally(function(){e.$rootScope.pageLoader=!1})},function(){e.handleError(401)})},t.prototype.createItem=function(t,e,o){var n=this,r={properties:{type:"trg",date:e.toString(),patient:o},uploadedFile:t};return this.$authUser.getFileService().then(function(t){return n.$rootScope.pageLoader=!0,t.uploadFile(r).then(function(t){var r=new i.Trg(t.id,e,o);return n.items.push(r),r},n.handleFileError).finally(function(){n.$rootScope.pageLoader=!1})},function(){n.handleError(401)})},t.prototype.updateItem=function(t,e){for(var o=this,i={type:"trg",date:e.getDateAsString(),patient:e.patient},n=0,r=e.getPointsJson();n<r.length;n++){var s=r[n];i["point"+s.id]=JSON.stringify(s)}var a={id:t,properties:i};return this.$authUser.getFileService().then(function(t){return o.$rootScope.pageLoader=!0,t.updateFile(a).then(function(){for(var t=0,i=o.items;t<i.length;t++){var n=i[t];n.id==e.id&&(n.patient=e.patient,n.date=e.date,n.points=e.points)}return e},o.handleFileError).finally(function(){o.$rootScope.pageLoader=!1})},function(){o.handleError(401)})},t.$inject=["TrgHandbookService","$rootScope","$mdDialog","$mdDateLocale","$state","$authUser"],t}();e.TrgService=s}.apply(e,i))&&(t.exports=n)},function(t,e,o){(function(i){var n,r;n=[o,e],void 0!==(r=function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e,o,i,n){var r=this;this.$rootScope=t,this.$q=e,this.$location=o,this.$http=i,this.yandexClientId=n,this.code="yandex",this.fieldToken="yandexToken",this.authorizeUrl="https://oauth.yandex.ru/authorize",this.resourcesUrl="https://cloud-api.yandex.net/v1/disk/resources",this.listenAuthentication=function(){r.$rootScope.$on("$locationChangeSuccess",function(t,e){if(/state=yandex/.test(e)){var o=/access_token=([^&]+)/,i=/error=([^&]+)/;o.test(e)?(localStorage.setItem(r.fieldToken,o.exec(e)[1]),r.fetchProfile().then(function(t){r.$rootScope.$emit("signIn",r.code,t,t)},function(){r.signOut(),r.$rootScope.$emit("signReject",r.code)})):i.test(e)&&r.$rootScope.$emit("signReject",r.code),r.$location.url("/")}}),r.getToken()&&r.fetchProfile().then(function(t){r.$rootScope.$emit("signIn",r.code,t,t)},function(){r.signOut(),r.$rootScope.$emit("signReject",r.code)})},this.signIn=function(){location.href=r.authorizeUrl+"?response_type=token&client_id="+r.yandexClientId+"&state=yandex"},this.signOut=function(){localStorage.removeItem(r.fieldToken),location.hash=""},this.getExtensionByMimeType=function(t){var e="";switch(t){case"image/jpeg":case"image/jpg":e="jpg";break;case"image/png":e="png";break;case"image/gif":e="gif";break;default:throw new Error("Unknown file type")}return e},this.handleFileError=function(t){return function(e){throw e.data?t.error=e.data.message||e.data.description||e.data.error||e.statusText:t.error=e.statusText,t.errorCode=e.status,t}},this.listenAuthentication()}return t.prototype.fetchProfile=function(){return this.$http.get("https://login.yandex.ru/info?format=json&oauth_token="+this.getToken()).then(function(t){return{userName:t.data.display_name,email:t.data.emails[0]||null}})},t.prototype.getRequestHeaders=function(){return{Authorization:"OAuth "+this.getToken()}},t.prototype.getToken=function(){return localStorage.getItem(this.fieldToken)},t.prototype.getIsSignedIn=function(){var t=this.$q.defer();return t.resolve(!!this.getToken()),t.promise},t.prototype.getRemotePath=function(t){return void 0===t&&(t=""),"app:/"+this.basename(t)},t.prototype.basename=function(t){return t.split("/").pop()},t.prototype.uploadFile=function(t){var e=this,o=this.handleFileError(t),n=this.getExtensionByMimeType(t.uploadedFile.type),r=i(new Date).format("YYYYMMDDHHmmss")+"."+n;return this.$http.get(this.resourcesUrl+"/upload?path="+this.getRemotePath(r),{headers:this.getRequestHeaders()}).then(function(i){var n=i.data.href;return e.$http.put(n,t.uploadedFile,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){return t.id=r,e.updateFile(t)},o)},o)},t.prototype.getFiles=function(){var t=this;return this.$http.get(this.resourcesUrl+"?path="+this.getRemotePath()+"&limit=1000&fields=_embedded.items.path,_embedded.items.custom_properties",{headers:this.getRequestHeaders()}).then(function(e){for(var o=[],i=0,n=e.data._embedded.items;i<n.length;i++){var r=n[i];if(r.custom_properties){var s={id:t.basename(r.path),properties:r.custom_properties};o.push(s)}}return o},function(){return[]})},t.prototype.getFile=function(t){var e=this,o={},i=this.getRemotePath(t),n=this.$q.defer();return this.$http.get(this.resourcesUrl+"?path="+i+"&fields=path,custom_properties",{headers:this.getRequestHeaders()}).then(function(t){return o.id=e.basename(t.data.path),o.properties=t.data.custom_properties,e.$http.get(e.resourcesUrl+"/download?path="+i,{headers:e.getRequestHeaders()}).then(function(t){return o.url=t.data.href,o},e.handleFileError(o))},this.handleFileError(o)).then(function(t){var e=new Image;e.src=t.url,e.onload=function(){t.imageWidth=e.width,t.imageHeight=e.height,n.resolve(t)}},function(t){n.reject(t)}),n.promise},t.prototype.removeFile=function(t){var e=this.getRemotePath(t);return this.$http.delete(this.resourcesUrl+"?path="+e+"&permanently=true",{headers:this.getRequestHeaders()}).then(function(){return!0},function(){return!1})},t.prototype.updateFile=function(t){return this.$http.patch(this.resourcesUrl+"?path="+this.getRemotePath(t.id),{custom_properties:t.properties},{headers:this.getRequestHeaders()}).then(function(){return t},this.handleFileError(t))},t}();e.YandexApi=o}.apply(e,n))&&(t.exports=r)}).call(e,o(0))},function(t,e,o){var i,n;i=[o,e,o(48)],void 0!==(n=function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){var t=this;this.$get=["$rootScope","$q","$location","$http",function(e,i,n,r){return t.instance||(t.instance=new o.YandexApi(e,i,n,r,t.clientId)),t.instance}]}return t.prototype.setClientId=function(t){this.clientId=t},t}();e.YandexApiProvider=i}.apply(e,i))&&(t.exports=n)},,function(t,e){t.exports=[{id:"SNB",description:"угол между плоскостями SeN и NB, характеризующий положение нижней челюсти в саггитальной плоскости (относительно переднего основания черепа)",points:["N","Se","N","B"]},{id:"SNA",description:"угол между плоскостями SeN и NA, характеризующий положение верхней челюсти в саггитальной плоскости (относительно переднего основания черепа)",points:["N","Se","N","A"]},{id:"ANB",description:"угол между плоскостями NA и NB, характеризующий соотношение апикальных базисов верхней и нижней челюсти",points:["N","A","N","B"]},{id:"1 - SN",description:"угол наклона верхнего резца к плоскости переднего отдела основания черепа",points:["N","Se","Ar","A1"]},{id:"IMPA",description:"угол между плоскостью нижней челюсти и осью нижнего резца",points:["Me","Ir","Br","B1"]},{id:"II",description:"межрезцовый угол",points:["A1","Ar","B1","Br"]},{id:"SNMP",description:"угол между плоскостью основания черепа и плоскостью нижней челюсти (инклинация нижней челюсти)",points:["Se","N","Ir","Me"]}]},function(t,e){t.exports=[{id:"N",description:"назион, наиболее передняя точка носолобного шва в сагиттальной плоскости",color:"#FF0000"},{id:"Se",description:"точка в центре площади турецкого седла",color:"#FF0000"},{id:"Me",description:"ментон, нижняя точка на нижнем контуре тела нижней челюсти",color:"#FF0000"},{id:"Ir",description:"точка для определения плоскости нижней челюсти",color:"#FF0000"},{id:"A",description:"субспинале, наиболее глубокая точка на апикальном базисе верхней челюсти",color:"#FF0000"},{id:"B",description:"супраментале, наиболее глубокая точка на апикальном базисе нижней челюсти",color:"#FF0000"},{id:"A1",description:"режущий край верхнего центрального резца",color:"#FF0000"},{id:"Ar",description:"апикальная точка верхнего центрального резца",color:"#FF0000"},{id:"B1",description:"режущий край нижнего центрального резца",color:"#FF0000"},{id:"Br",description:"апикальная точка нижнего центрального резца",color:"#FF0000"}]},function(t,e){t.exports=[{id:"SeN",description:"плоскость переднего отдела основания черепа",points:["Se","N"],color:"#FF0000",plane:!0},{id:"ML",description:"плоскость нижней челюсти",points:["Ir","Me"],color:"#FF0000",plane:!0},{id:"NA",description:"линия, соединяющая точки N и A",points:["N","A"],color:"#FF0000",plane:!1},{id:"NB",description:"линия, соединяющая точки N и B",points:["N","B"],color:"#FF0000",plane:!1},{id:"B1Br",description:"ось нижнего резца",points:["B1","Br"],color:"#FF0000",plane:!0},{id:"A1Ar",description:"ось верхнего резца",points:["A1","Ar"],color:"#FF0000",plane:!0}]},function(t,e,o){t.exports=o(3)}],[54]);